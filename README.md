# 图片重复查找器

这是一个基于大模型的图片重复查找系统，利用LLaVA模型提取图片特征向量，并使用FAISS向量数据库进行高效相似度搜索。该系统以Electron桌面应用的形式提供，旨在帮助用户轻松管理和清理重复图片。

## 功能特性

-   **图片特征提取**: 利用强大的 **LLaVA** 多模态大模型，从图片中提取高维、语义丰富的特征向量。结合 **Sharp** 库进行高效的图像预处理（如调整大小），确保特征提取的准确性和效率。
-   **高效相似度搜索**: 集成 **FAISS (Facebook AI Similarity Search)** 向量数据库，实现对海量图片特征向量的快速相似度搜索。采用 L2 距离作为相似度度量，并支持自定义相似度阈值。
-   **重复图片查找**: 能够扫描指定目录下的所有图片，自动识别并分组显示重复或高度相似的图片，帮助用户进行清理。
-   **Electron桌面应用**: 提供直观、易用的图形用户界面 (GUI)，方便用户进行图片目录选择、索引、相似图片查找、设置管理以及数据库重置等操作。
-   **本地模型支持**: 通过 **Ollama** 运行时，支持在本地运行 LLaVA 模型，保护用户数据隐私，并减少对外部服务的依赖。

## 技术栈

-   **Electron**: 用于构建跨平台的桌面应用程序，提供友好的用户交互界面。
-   **Node.js**: 作为后端运行时，处理文件系统操作、与Ollama服务通信以及集成FAISS库。
-   **LLaVA**: 大型多模态语言模型，负责从图像中提取视觉特征并生成向量嵌入。
-   **FAISS**: 高性能的相似性搜索库，用于存储和查询图片特征向量，实现快速的相似图片匹配。
-   **Sharp**: Node.js 中用于图像处理的高性能库，负责图像的读取、预处理（如缩放）等操作。
-   **Ollama**: 一个轻量级的框架，用于在本地运行大型语言模型，本项目用它来运行 LLaVA 模型。
-   **electron-store**: 用于在Electron应用中持久化存储用户配置和设置。
-   **LangChain.js**: 用于与Ollama模型进行交互，简化了模型调用和嵌入生成的过程。

## 安装与运行

### 前置条件

1.  **安装 Node.js**: 确保您的系统安装了 Node.js (推荐 v18 或更高版本)。
2.  **安装 Ollama**: 从 [Ollama 官网](https://ollama.ai/) 下载并安装 Ollama。
3.  **下载 LLaVA 模型**: 安装 Ollama 后，打开命令行或终端，运行以下命令下载 LLaVA 模型：
    ```bash
    ollama run llava
    ```
    这将下载并启动 LLaVA 模型。请确保 Ollama 服务在本地运行（默认端口 11434）。

### 项目安装

1.  **克隆仓库**:
    ```bash
    git clone https://github.com/your-username/image-duplicate-finder.git
    cd image-duplicate-finder
    ```
2.  **安装依赖**:
    ```bash
    npm install
    ```

### 运行应用

1.  **开发模式**:
    ```bash
    npm run start:dev
    ```
    这会使用 `nodemon` 监控文件变化并自动重启应用，方便开发调试。

2.  **生产模式**:
    ```bash
    npm start
    ```
    直接启动 Electron 应用。

### 构建应用

```bash
npm run build
```
这会根据 `electron-builder` 配置打包应用，生成适用于您操作系统的可执行文件（例如 `.dmg` for macOS, `.exe` for Windows, `.AppImage` for Linux），输出到 `dist` 目录下。

## 使用说明

1.  **启动应用**: 运行 `npm start` 或 `npm run start:dev` 启动桌面应用程序。
2.  **初始化与设置**:
    *   首次启动时，应用会自动尝试初始化。
    *   进入“设置”选项卡，您可以：
        *   **选择默认图片目录**: 这是您希望系统索引和查找图片的根目录。
        *   **选择模型**: 确保这里选择的是您已通过 Ollama 下载并运行的 `llava` 模型。
        *   **调整默认相似度阈值和最大结果数**: 这些设置会影响相似图片查找的结果。
        *   点击“保存设置”以应用更改。
3.  **索引图片**:
    *   在“设置”选项卡中，选择好“默认图片目录”后，点击“立即索引”按钮。
    *   系统将开始处理该目录及其子目录下的所有支持的图片文件（JPG, JPEG, PNG, GIF, WEBP），提取它们的特征向量并存储到本地的 FAISS 数据库中。这个过程可能需要一些时间，具体取决于图片数量和您的硬件性能。
    *   索引数据将保存在项目根目录下的 `vector_db` 文件夹中。
4.  **查找相似图片**:
    *   切换到“查找相似图片”选项卡。
    *   点击“浏览...”按钮选择一张您想要查找相似图片的本地图片。
    *   调整“最大结果数”以控制显示多少个相似图片。
    *   点击“查找相似图片”按钮。系统将根据您选择的图片，在已索引的数据库中查找并显示与之最相似的图片及其相似度分数。
5.  **重置数据库**:
    *   在“设置”选项卡中，点击“重置数据库”按钮。
    *   **警告**: 此操作将永久删除所有已索引的图片数据和 FAISS 数据库文件，且不可恢复。请谨慎操作。

## 项目结构

```
.
├───.gitignore            # Git 版本控制忽略文件
├───nodemon.json          # nodemon 配置文件，用于开发模式自动重启
├───package.json          # 项目依赖、脚本和元数据
├───README.md             # 项目说明文档
├───src/                  # 源代码目录
│   ├───imageDuplicateFinder.js # 核心业务逻辑：整合图片处理和向量存储，提供高级查找功能
│   ├───imageProcessor.js     # 图片处理模块：负责图像的加载、预处理（使用Sharp）和特征提取（通过Ollama调用LLaVA）
│   ├───vectorStore.js        # 向量存储模块：封装FAISS数据库的操作，包括向量的添加、搜索、保存和删除
│   └───electron/             # Electron 应用的特定文件
│       ├───index.html        # 应用程序的主界面 HTML 结构
│       ├───main.js           # Electron 主进程脚本，处理窗口创建、IPC通信和系统级操作
│       ├───preload.js        # 预加载脚本，在渲染进程加载前运行，用于安全地暴露Node.js API给渲染进程
│       ├───renderer.js       # 渲染进程脚本，处理用户界面交互和调用主进程功能
│       └───styles.css        # 应用程序的全局样式表
└───vector_db/            # 存储 FAISS 索引文件 (`faiss.index`) 和图片元数据 (`metadata.json`) 的目录
```

## 许可证

本项目采用 MIT 许可证。

## 贡献

欢迎贡献！如果您有任何建议、功能请求或发现 Bug，请随时通过提交 Issue 或 Pull Request 的方式参与进来。