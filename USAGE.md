# 图片重复查找器 - 使用说明

## 快速开始

### 1. 启动应用
```bash
# 开发模式（推荐）
npm run start:dev

# 或生产模式
npm run start
```

### 2. 前置条件
在使用应用之前，请确保：

1. **安装并运行 Ollama**
   ```bash
   # 安装 Ollama（如果还没安装）
   # 从 https://ollama.ai/ 下载安装包
   
   # 下载并运行 LLaVA 模型
   ollama run llava
   ```

2. **确保 Ollama 服务正在运行**
   - 默认端口：11434
   - 可以通过 `http://localhost:11434` 访问

### 3. 使用步骤

#### 第一步：系统设置
1. 打开应用后，默认进入"设置"选项卡
2. 点击"检查服务"按钮，确保 Ollama 服务可用
3. 设置默认图片目录（可选）
4. 调整相似度阈值和其他参数
5. 点击"保存设置"

#### 第二步：索引图片
1. 切换到"索引图片"选项卡
2. 点击"浏览..."选择要索引的图片目录
3. 点击"开始索引"按钮
4. 等待索引完成（会显示进度条）

#### 第三步：查找相似图片
1. 切换到"查找相似图片"选项卡
2. 点击"浏览..."选择一张查询图片
3. 调整最大结果数和相似度阈值
4. 点击"查找相似图片"按钮
5. 查看结果列表



## 功能说明

### 支持的图片格式
- JPG/JPEG
- PNG
- GIF
- WEBP

### 相似度阈值说明
- **0.8-1.0**: 非常相似，可能是重复图片
- **0.6-0.8**: 相似，可能是同一场景的不同角度
- **0.4-0.6**: 部分相似，可能有共同元素
- **0.2-0.4**: 轻微相似，可能有相似颜色或纹理

### 系统状态说明
- **已初始化**: 系统正常运行
- **已索引图片**: 数据库中存储的图片数量
- **向量维度**: LLaVA 模型输出的特征向量维度
- **支持格式**: 当前支持的图片格式

## 故障排除

### 1. Ollama 服务不可用
**症状**: 点击"检查服务"显示"Ollama 服务不可用"

**解决方案**:
```bash
# 检查 Ollama 是否安装
ollama --version

# 如果没有安装，从官网下载安装
# https://ollama.ai/

# 下载 LLaVA 模型
ollama run llava

# 检查服务状态
curl http://localhost:11434/api/tags
```

### 2. 索引失败
**症状**: 索引过程中出现错误

**可能原因**:
- 目录中没有支持的图片格式
- 图片文件损坏
- 磁盘空间不足

**解决方案**:
- 检查目录中是否有支持的图片文件
- 确保图片文件完整且可读
- 检查磁盘空间

### 3. 查找结果为空
**症状**: 查找相似图片时没有结果

**可能原因**:
- 数据库为空（需要先索引图片）
- 相似度阈值设置过高
- 查询图片不在索引范围内

**解决方案**:
- 确保已经索引了包含查询图片的目录
- 降低相似度阈值
- 检查查询图片是否在已索引的目录中

### 4. 应用启动失败
**症状**: 应用无法启动或启动后立即崩溃

**解决方案**:
```bash
# 清理并重新安装依赖
rm -rf node_modules package-lock.json
npm install

# 重新启动应用
npm run start
```

## 高级功能

### 1. 批量处理
- 应用支持批量索引大量图片
- 进度条显示处理进度
- 可以随时停止索引过程

### 2. 文件操作
- 右键点击结果可以打开文件
- 可以显示文件在系统中的位置
- 支持直接打开图片文件

### 3. 设置持久化
- 应用会自动保存用户设置
- 下次启动时会恢复之前的配置
- 支持重置数据库功能

## 性能优化建议

### 1. 硬件要求
- **内存**: 建议 8GB 以上
- **存储**: 根据图片数量，建议预留足够空间
- **CPU**: 多核处理器可以加快处理速度

### 2. 使用建议
- 首次索引大量图片时，建议分批进行
- 定期清理不需要的图片以节省空间
- 对于大量图片，建议使用 SSD 存储

### 3. 网络配置
- 如果使用远程 Ollama 服务，确保网络连接稳定
- 可以配置 Ollama 服务地址（需要修改代码）

## 技术架构

### 核心组件
- **LLaVA 模型**: 负责图片特征提取
- **FAISS 向量数据库**: 存储和搜索图片特征
- **Sharp 图像处理**: 图片预处理和格式转换
- **Electron 框架**: 跨平台桌面应用

### 数据存储
- 向量数据库文件: `vector_db/faiss.index`
- 元数据文件: `vector_db/metadata.json`
- 应用设置: 存储在系统用户数据目录

## 更新和维护

### 1. 更新应用
```bash
# 拉取最新代码
git pull

# 重新安装依赖
npm install

# 重启应用
npm run start
```

### 2. 清理数据
```bash
# 删除向量数据库（会丢失所有索引数据）
rm -rf vector_db/

# 重新启动应用
npm run start
```

### 3. 日志查看
应用运行时的日志会输出到控制台，可以通过以下方式查看：
- 开发模式：直接在终端查看
- 生产模式：查看系统日志

## 联系和支持

如果遇到问题或有改进建议，请：
1. 检查本文档的故障排除部分
2. 查看应用控制台输出的错误信息
3. 确保所有前置条件都已满足
4. 尝试重新安装和配置

---

**注意**: 本应用使用本地 LLaVA 模型，所有图片处理都在本地进行，保护用户隐私。 